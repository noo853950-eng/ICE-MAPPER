<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PATS | Operational Variant A</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    
    <style>
        :root { --bg: #020617; --card: #1e293b; --accent: #38bdf8; --danger: #ef4444; --text: #f8fafc; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: var(--bg); color: var(--text); font-family: sans-serif; overflow: hidden; }
        .app-container { display: flex; flex-direction: column; height: 100vh; }
        header { background: var(--card); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; z-index: 1001; }
        #map { flex-grow: 1; z-index: 1; background: #000; }
        .controls { position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 90%; max-width: 400px; }
        .action-card { background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(8px); padding: 15px; border-radius: 12px; border: 1px solid #475569; }
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 8px; display: block; text-align: center; font-size: 14px; }
        .btn-blue { background: var(--accent); color: #000; }
        .btn-ghost { background: #475569; color: white; font-size: 11px; }
        .btn-outline { background: transparent; color: var(--danger); border: 1px solid var(--danger); font-size: 11px; }
        #gate-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        input { padding: 12px; border-radius: 6px; border: 1px solid #334155; background: #1e293b; color: white; width: 100%; max-width: 250px; margin-bottom: 10px; text-align: center; }
        /* Style override for search bar */
        .leaflet-control-geocoder { background: var(--card) !important; color: white !important; border: 1px solid #475569 !important; }
        .leaflet-control-geocoder-icon { filter: invert(1); }
    </style>
</head>
<body>

<div id="gate-overlay">
    <h2>Access Required</h2>
    <input type="password" id="invite-code" placeholder="Enter Token...">
    <button class="btn btn-blue" style="max-width: 275px;" onclick="verifyAccess()">Unlock</button>
</div>

<div class="app-container">
    <header>
        <div><strong>PATS</strong> <small id="mode-label" style="color:var(--accent)">V.A-2026</small></div>
        <div id="status" style="font-size: 0.7rem; color: #34d399;">‚óè LIVE</div>
    </header>
    <div id="map"></div>
    <div class="controls">
        <div class="action-card">
            <button id="report-btn" class="btn btn-blue">üì¢ Report Activity at Center</button>
            <button id="ghost-btn" class="btn btn-ghost">Toggle Ghost Mode (Disguise)</button>
            <button id="panic-btn" class="btn btn-outline">EMERGENCY WIPE</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<script>
    let map;
    let hotspots = [];
    let isGhostMode = false;

    function verifyAccess() {
        if (document.getElementById('invite-code').value === "Urban2026") {
            document.getElementById('gate-overlay').style.display = 'none';
            initMap();
        } else { alert("Invalid Token"); }
    }

    function initMap() {
        map = L.map('map', { zoomControl: false }).setView([40.7128, -74.0060], 12);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        // Add Search Bar
        const geocoder = L.Control.geocoder({
            defaultMarkGeocode: false,
            placeholder: "Search City or Zip..."
        }).on('markgeocode', function(e) {
            map.flyTo(e.geocode.center, 14);
        }).addTo(map);

        setupListeners();
    }

    function setupListeners() {
        // Report Center
        document.getElementById('report-btn').addEventListener('click', () => {
            const center = map.getCenter();
            addHotspot(center.lat, center.lng);
        });

        // Ghost Mode Toggle
        document.getElementById('ghost-btn').addEventListener('click', toggleGhostMode);

        // Wipe
        document.getElementById('panic-btn').addEventListener('click', () => {
            if(confirm("Erase all?")) { localStorage.clear(); window.location.href = "https://weather.com"; }
        });
    }

    function addHotspot(lat, lng) {
        const color = isGhostMode ? "#fbbf24" : "#ef4444"; // Amber for "Traffic", Red for "Alert"
        const label = isGhostMode ? "Moderate Traffic Delay" : "ACTIVITY REPORTED";
        
        const circle = L.circle([lat, lng], {
            color: color, fillColor: color, fillOpacity: 0.5, radius: 500
        }).addTo(map).bindPopup(`<b>${label}</b><br>${new Date().toLocaleTimeString()}`);
        
        hotspots.push(circle);
    }

    function toggleGhostMode() {
        isGhostMode = !isGhostMode;
        const color = isGhostMode ? "#fbbf24" : "#ef4444";
        const label = isGhostMode ? "Moderate Traffic Delay" : "ACTIVITY REPORTED";
        const modeText = isGhostMode ? "TRAFFIC-V.2" : "V.A-2026";
        
        document.getElementById('mode-label').innerText = modeText;
        document.getElementById('mode-label').style.color = isGhostMode ? "#fbbf24" : "#38bdf8";

        hotspots.forEach(h => {
            h.setStyle({ color: color, fillColor: color });
            h.getPopup().setContent(`<b>${label}</b><br>Updated: ${new Date().toLocaleTimeString()}`);
        });
    }
</script>
</body>
</html>
